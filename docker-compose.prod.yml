---
# Puter 完整部署方案
# 使用本地 Dockerfile 构建自定义镜像
version: "3.8"
services:
  puter:
    container_name: puter
    # 使用本地 Dockerfile 构建
    build:
      context: .
      dockerfile: Dockerfile
    image: puter-custom:latest
    restart: unless-stopped
    ports:
      - '4100:4100'
    environment:
      TZ: Asia/Shanghai
      PUID: 1000
      PGID: 1000
    volumes:
      - ./config:/etc/puter
      - ./data:/var/puter
    healthcheck:
      test: wget --no-verbose --tries=1 --spider http://127.0.0.1:4100/test || exit 1
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 30s
    labels:
      - "com.docker.compose.project=puter"
      - "description=Puter - 支持反向代理的自定义版本"

# 部署说明：
#
# 1. 在服务器上克隆仓库：
#    git clone https://github.com/laaacf/puter_test.git ~/docker/puter
#
# 2. 进入目录：
#    cd ~/docker/puter
#
# 3. 创建目录和配置：
#    mkdir -p config data
#    sudo chown -R 1000:1000 config data
#
# 4. 上传或创建 config/config.json（包含必要配置）
#
# 5. 构建并启动：
#    sudo docker compose build
#    sudo docker compose up -d
#
# 或者使用 Portainer：
# - 在 Portainer 中添加 Stack
# - 粘贴此配置文件内容
# - 修改 volumes 路径为实际路径
